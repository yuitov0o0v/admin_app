ğŸ”´ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«: is_admin() é–¢æ•°ãŒ app_metadata ã‚’å‚ç…§ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã«ã¯ custom_access_token_hook ã§ user_role ã«è¨­å®šã—ã¦ã„ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯ãŒæ©Ÿèƒ½ã—ãªã„
ğŸ”´ ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: invitations ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã™ã‚‹ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã«ã‚ˆã‚Šã€éå»ã«æ‹›å¾…ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å†æ‹›å¾…ã§ããªã„
ğŸŸ¡ é‹ç”¨ä¸Šã®å•é¡Œ: æœŸé™åˆ‡ã‚Œæ‹›å¾…ã‚’è‡ªå‹•å‰Šé™¤ã™ã‚‹ expire_old_invitations() é–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŒã€è‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹è¨­å®šãŒãªã„



ã‚¹ã‚­ãƒ¼ãƒã«authã®ãƒˆãƒªã‚¬ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ãªã„ã®ã§å¿…ãšDBã®è¤‡è£½æ™‚ã¯ãƒˆãƒªã‚¬ãƒ¼ã®ä½œæˆã‚’è¡Œã†ã‚ˆã†ã«ã™ã‚‹


  SELECT COALESCE(
    nullif(current_setting('request.jwt.claims', true), '')::jsonb
      -> 'app_metadata' ->> 'role',
    'user'
  ) = 'admin';
